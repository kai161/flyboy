<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Comet LongPolling</title>
    <script src="../../../static/jquery-1.8.2.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function(){

            connect();

            $("#btn").click(function(){
                var msg=$("#msg").val();

                $.ajax({
                    url:"/comet/longpolling?method=onMessage&msg="+msg,
                    cache:false,
                    dataType:"text",
                    success:function(data){
                        var html="<p>"+msg+"</p>"
                        $("#show").append(html);
                    }

                });

            });

        });

        function connect(){
            $.ajax({
                url:"/comet/longpolling?method=onOpen",
                cache:false,
                dataType:"text",
                success:function(data){
                    connect();
                    var html="<p>"+data+"</p>"
                    $("#show").append(html);
                }
            });
        }
    </script>
</head>
<body>
<h1>LongPolling</h1>
<p id="show"></p>
<input type="text" id="msg" /><input id="btn" type="button" value="发送" />
</body>
</html>